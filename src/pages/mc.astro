---
import { getEntry, render } from "astro:content";
import Markdown from "@components/misc/Markdown.astro";
import I18nKey from "../i18n/i18nKey";
import { i18n } from "../i18n/translation";
import MainGridLayout from "../layouts/MainGridLayout.astro";
import Comment from "@components/comment/index.astro";

const aboutPost = await getEntry("spec", "about");

if (!aboutPost) {
	throw new Error("About page content not found");
}

const { Content } = await render(aboutPost);
---

<MainGridLayout title={i18n(I18nKey.about)} description={i18n(I18nKey.about)}>
  <div class="flex w-full rounded-[var(--radius-large)] overflow-hidden relative min-h-32">
    <div class="card-base z-10 px-9 py-6 relative w-full">
      <h1 class="text-3xl font-bold text-dark mb-2">MinecraftçŠ¶æ€</h1>
      <p class="text-gray-600 mb-8">ä½³è‰ã®æ•¦ä¸–ç•Œ</p>

      <!-- é¡¶éƒ¨ç»Ÿè®¡æ–¹å— -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <!-- æœåŠ¡å™¨ç‰ˆæœ¬ -->
        <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-lg p-4 transition-all duration-300">
          <div class="flex items-center gap-3">
            <div class="text-2xl">ğŸ®</div>
            <div>
              <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" id="server-version">1.21.6</div>
              <div class="text-sm text-blue-600/70 dark:text-blue-400/70">æœåŠ¡å™¨ç‰ˆæœ¬</div>
            </div>
          </div>
        </div>
        
        <!-- æ’ä»¶æœ -->
        <div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-lg p-4 transition-all duration-300">
          <div class="flex items-center gap-3">
            <div class="text-2xl">ğŸ”Œ</div>
            <div>
              <div class="text-2xl font-bold text-green-600 dark:text-green-400">æ’ä»¶æœ</div>
              <div class="text-sm text-green-600/70 dark:text-green-400/70">æ ¸å¿ƒç±»å‹</div>
            </div>
          </div>
        </div>
        
        <!-- åœ¨çº¿äººæ•° -->
        <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20 rounded-lg p-4 transition-all duration-300">
          <div class="flex items-center gap-3">
            <div class="text-2xl">ğŸ‘¥</div>
            <div>
              <div class="text-2xl font-bold text-yellow-600 dark:text-yellow-400" id="player-count">åŠ è½½ä¸­...</div>
              <div class="text-sm text-yellow-600/70 dark:text-yellow-400/70">åœ¨çº¿äººæ•°</div>
            </div>
          </div>
        </div>
        
        <!-- æ­£ç‰ˆéªŒè¯ -->
        <div class="bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-lg p-4 transition-all duration-300 ">
          <div class="flex items-center gap-3">
            <div class="text-2xl">ğŸ”’</div>
            <div>
              <div class="text-2xl font-bold text-purple-600 dark:text-purple-400">å¦</div>
              <div class="text-sm text-purple-600/70 dark:text-purple-400/70">æ­£ç‰ˆéªŒè¯</div>
            </div>
          </div>
        </div>
      </div>

      <!-- æœåŠ¡å™¨è¯¦æƒ… -->
      <div style="box-shadow: rgba(0, 0, 0, 0.02) 0px 1px 3px 0px, rgba(27, 31, 35, 0.15) 0px 0px 0px 1px;" class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-md mb-8 transition-all duration-300 ">
        <h2 class="text-2xl font-bold text-dark dark:text-white mb-4">æœåŠ¡å™¨è¯¦æƒ…</h2>
        <p class="text-gray-600 dark:text-gray-300 mb-4">ä»¥åŸç‰ˆçº¯ç”Ÿå­˜ä¸ºæ ¸å¿ƒçš„é•¿æœŸæ€§å…¬ç›ŠæœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨é™åˆ¶æ€§è¾ƒå°‘ï¼Œåå¯¹ä½œå¼Šï¼Œåœ¨è¿™é‡Œä½ å¯ä»¥ç€æ‰‹ä¸å¥½å‹ç»„å»ºè‡ªå·±çš„å°é•‡ï¼Œæ¢æ¡ˆæ›´å¤šæœªå¼€å‘çš„å¤§é™†ã€‚ã€<span style="color:hotpink">åŸç‰ˆï¼Œçº¯å‡€ç”Ÿå­˜ï¼Œé•¿æœŸï¼Œå…¬ç›Šï¼Œæ’ä»¶ï¼Œå…»è€ï¼Œä¸åˆ æ¡£</span>ã€‘ã€‚</p>
        <p class="text-gray-600 dark:text-gray-300 mb-4">æœåŠ¡å™¨å®šæœŸæ›´æ–°ç»´æŠ¤ï¼Œç¡®ä¿ç‰ˆæœ¬ç¨³å®šï¼ŒåŒæ—¶æœ‰ä¸“ä¸šçš„ç®¡ç†å›¢é˜Ÿç»´æŠ¤ç§©åºï¼Œè¥é€ å’Œè°çš„æ¸¸æˆç¯å¢ƒã€‚æ¬¢è¿å„ä½ç©å®¶åŠ å…¥ï¼Œä¸€èµ·æ¢ç´¢MCçš„ä¸–ç•Œï¼</p>
        <p class="text-gray-600 dark:text-gray-300 mb-4">QQäº¤æµç¾¤ï¼š1153119841</p>
        <div class="mt-6">
          <a href="http://g1-10.xyeidc.cn:20987/#world:-34:0:45:506:0:0:0:0:perspective" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-all duration-300">æŸ¥çœ‹å«æ˜Ÿå›¾</a>
          <a href="#" id="copyLink" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-all duration-300">åŠ å…¥æœåŠ¡å™¨</a>
        </div>
      </div>
      <div style="box-shadow: rgba(0, 0, 0, 0.02) 0px 1px 3px 0px, rgba(27, 31, 35, 0.15) 0px 0px 0px 1px;" class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-md mb-8 transition-all duration-300 ">

      <p>å†™å…¥ä¸­............</p>
      </div>
      </div>
    </div>
  </div>
</MainGridLayout>



<script>
const copyLink = document.getElementById('copyLink');
        // è¦å¤åˆ¶çš„æ–‡å­—å†…å®¹
        const textToCopy = 'g1-10.xyeidc.cn:20504';

        copyLink.addEventListener('click', function (event) {
            // é˜»æ­¢ <a> æ ‡ç­¾é»˜è®¤çš„è·³è½¬è¡Œä¸º
            event.preventDefault();
            
            // ä½¿ç”¨ Clipboard API çš„ writeText æ–¹æ³•å¤åˆ¶æ–‡å­—
            navigator.clipboard.writeText(textToCopy)
                .then(() => {
                    alert('æœåŠ¡å™¨IPå¤åˆ¶æˆåŠŸï¼');
                })
                .catch(err => {
                    alert('å¤åˆ¶å¤±è´¥ï¼š', err);
                });
        });

  // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
  document.addEventListener('DOMContentLoaded', function() {
    const serverAddress = 'g1-10.xyeidc.cn:20504';
    // åˆå§‹åŠ è½½æœåŠ¡å™¨ä¿¡æ¯
    queryServer(serverAddress);
    // æ¯30ç§’åˆ·æ–°ä¸€æ¬¡æœåŠ¡å™¨ä¿¡æ¯
    setInterval(() => queryServer(serverAddress), 30000);
  });

  // æŸ¥è¯¢æœåŠ¡å™¨ä¿¡æ¯
  function queryServer(address) {
    const url = `https://api.mcsrvstat.us/2/${address}`;
    fetch(url)
      .then(response => response.json())
      .then(data => {
        const players = data.players || { online: 0, max: 100, list: [], uuid: {} };
        updateServerInfo({...data, players});
      })
      .catch(error => {
        console.error('è·å–æœåŠ¡å™¨ä¿¡æ¯å¤±è´¥:', error);
        document.getElementById('players-list').innerHTML = `
          <div class="no-players">
            <i class="fas fa-exclamation-circle"></i> åŠ è½½ç©å®¶ä¿¡æ¯å¤±è´¥
          </div>
        `;
      });
  }

  // ä»mcuuid.netè·å–UUIDï¼ˆç”¨äºå¤´åƒï¼‰
  function getAvatarUUID(playerName) {
    return fetch(`https://mcuuid.net/api/nick/${playerName}`)
      .then(response => {
        if (!response.ok) {
          throw new Error('è·å–å¤´åƒUUIDå¤±è´¥');
        }
        return response.json();
      })
      .then(data => {
        // è¿”å›æ­£ç‰ˆUUIDï¼ˆä¸å«è¿å­—ç¬¦ï¼‰
        return data.id.replace(/-/g, '');
      })
      .catch(error => {
        console.error(`è·å–${playerName}çš„å¤´åƒUUIDå¤±è´¥:`, error);
        return null;
      });
  }

  // æ›´æ–°æœåŠ¡å™¨ä¿¡æ¯æ˜¾ç¤º
  function updateServerInfo(data) {
    // æ›´æ–°ç‰ˆæœ¬ä¿¡æ¯
    if (data.version) {
      document.getElementById('server-version').textContent = data.version;
    }
    
    // æ›´æ–°åœ¨çº¿äººæ•°
    document.getElementById('player-count').textContent = `${data.players.online}/${data.players.max}`;
    document.getElementById('current-players').textContent = data.players.online;
    document.getElementById('max-players').textContent = data.players.max;
    
    // æ›´æ–°ç©å®¶åˆ—è¡¨
    const playersListContainer = document.getElementById('players-list');
    
    if (data.players.online > 0 && data.players.list.length > 0) {
      playersListContainer.innerHTML = '';
      
      // ä¸ºæ¯ä¸ªç©å®¶åˆ›å»ºå…ƒç´ 
      data.players.list.forEach(async (player) => {
        // è·å–UUIDä¿¡æ¯
        let displayUuid = data.players.uuid && data.players.uuid[player] 
          ? data.players.uuid[player]
          : 'æœªçŸ¥UUID';
        const formattedDisplayUuid = formatUUID(displayUuid.replace(/-/g, ''));
        
        // è·å–å¤´åƒUUID
        const avatarUuid = await getAvatarUUID(player);
        let avatarUrl = `https://minotar.net/avatar/${player}/100`; // å¤‡ç”¨å¤´åƒ
        if (avatarUuid) {
          avatarUrl = `https://crafthead.net/avatar/${avatarUuid}`;
        }
        
        // åˆ›å»ºç©å®¶å…ƒç´ 
        const playerElement = document.createElement('div');
        playerElement.className = 'player-item bg-white dark:bg-gray-700';
        playerElement.innerHTML = `
          <div class="tooltip">ç‚¹å‡»å¤åˆ¶UUID</div>
          <img class="player-avatar loading-avatar" 
               src="${avatarUrl}" 
               alt="${player}çš„å¤´åƒ"
               onerror="this.src='https://minotar.net/avatar/${player}/100'; this.classList.remove('loading-avatar')"
               onload="this.classList.remove('loading-avatar')">
          <div class="player-info">
            <p class="player-name">
              <i class="fas fa-circle player-status"></i> ${player}
            </p>
            <p class="player-uuid" onclick="copyText('${displayUuid.replace(/-/g, '') || formattedDisplayUuid}')">${formattedDisplayUuid}</p>
          </div>
        `;
        
        playersListContainer.appendChild(playerElement);
      });
    } else {
      playersListContainer.innerHTML = `
        <div class="no-players bg-gray-50 dark:bg-gray-800 rounded-lg p-6 text-center col-span-full">
          <i class="fas fa-user-slash"></i> å½“å‰æ²¡æœ‰ç©å®¶åœ¨çº¿
        </div>
      `;
    }
  }

  // æ ¼å¼åŒ–UUIDä¸ºå¸¦è¿å­—ç¬¦çš„æ ‡å‡†æ ¼å¼
  function formatUUID(uuid) {
    if (uuid.length === 32) {
      return `${uuid.substr(0,8)}-${uuid.substr(8,4)}-${uuid.substr(12,4)}-${uuid.substr(16,4)}-${uuid.substr(20)}`;
    }
    return uuid;
  }

  
</script>